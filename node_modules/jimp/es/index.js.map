{"version":3,"sources":["../src/index.js"],"names":["FS","Path","EventEmitter","anyBase","bMFont","MkDirP","pixelMatch","ImagePHash","request","text","shape","color","effects","scan","promisify","MIME","clear","parseBitmap","getBuffer","getBufferAsync","isNodePattern","throwError","constants","alphabet","maxHashLength","NaN","i","maxHash","BIN","slice","Array","join","push","length","process","on","noop","isArrayBuffer","test","Object","prototype","toString","call","toLowerCase","indexOf","bufferFromArrayBuffer","arrayBuffer","buffer","Buffer","alloc","byteLength","view","Uint8Array","loadBufferFromPath","src","cb","readFile","match","err","response","data","isBuffer","msg","statusCode","Error","isRawRGBAData","obj","width","height","Uint8ClampedArray","makeRGBABufferFromRGB","rgbaBuffer","allocUnsafe","j","emptyBitmap","Jimp","args","PNG_FILTER_AUTO","MIME_PNG","path","write","mime","getBase64","getPixelColor","setPixelColor","jimpInstance","finish","evData","methodName","setTimeout","emitError","emitMulti","parseInt","w","h","_background","bitmap","writeUInt32BE","original","from","_quality","_deflateLevel","_deflateStrategy","_filterType","_rgba","_originalMime","imageData","isRGBA","extraConstructor","__extraConstructors","find","c","Promise","resolve","reject","run","then","catch","eventName","assign","emit","getMIME","getExtension","createWriteStream","getType","pathObj","parse","dir","sync","stream","end","l","Math","round","s","f","bool","n","AUTO","base","hash","getHash","x","y","edgeHandling","xi","yi","EDGE_EXTEND","EDGE_WRAP","idx","getPixelIndex","hex","readUInt32BE","entries","forEach","name","value","appendConstructorOption","read","image","create","rgbaToInt","r","g","b","a","pow","intToRGBA","rgba","floor","limit255","max","min","diff","img1","img2","threshold","bmp1","bmp2","cloneQuiet","resize","numDiffPixels","percent","distance","phash","hash1","hash2","colorDiff","rgba1","rgba2","maxVal","loadPages","pages","newPages","map","page","all","loadFont","file","font","chars","kernings","String","fromCharCode","id","firstString","first","second","amount","dirname","common","info","jimpEvMethod","evName","method","evNameBefore","evNameAfter","replace","wrappedCb","apply","result","clone","jimpEvChange","start","offset","scanQuiet","env","ENVIRONMENT","gl","window","self"],"mappings":"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","sourcesContent":["import FS from 'fs';\nimport Path from 'path';\nimport EventEmitter from 'events';\n\nimport anyBase from 'any-base';\nimport bMFont from 'load-bmfont';\nimport MkDirP from 'mkdirp';\nimport pixelMatch from 'pixelmatch';\n\nimport ImagePHash from './modules/phash';\nimport request from './request';\n\nimport * as text from './image-manipulation/text';\nimport * as shape from './image-manipulation/shape';\nimport * as color from './image-manipulation/color';\nimport * as effects from './image-manipulation/effects';\n\nimport scan from './utils/scan';\nimport promisify from './utils/promisify';\nimport * as MIME from './utils/mime';\nimport { clear } from './utils/log';\nimport { parseBitmap, getBuffer, getBufferAsync } from './utils/image-bitmap';\nimport { isNodePattern, throwError } from './utils/error-checking';\nimport * as constants from './constants';\n\nconst alphabet =\n    '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_';\n\n// an array storing the maximum string length of hashes at various bases\n// 0 and 1 do not exist as possible hash lengths\nconst maxHashLength = [NaN, NaN];\n\nfor (let i = 2; i < 65; i++) {\n    const maxHash = anyBase(anyBase.BIN, alphabet.slice(0, i))(\n        new Array(64 + 1).join('1')\n    );\n    maxHashLength.push(maxHash.length);\n}\n\nprocess.on('exit', clear);\n\n// no operation\nfunction noop() {}\n\n// error checking methods\n\nfunction isArrayBuffer(test) {\n    return (\n        Object.prototype.toString\n            .call(test)\n            .toLowerCase()\n            .indexOf('arraybuffer') > -1\n    );\n}\n\n// Prepare a Buffer object from the arrayBuffer. Necessary in the browser > node conversion,\n// But this function is not useful when running in node directly\nfunction bufferFromArrayBuffer(arrayBuffer) {\n    const buffer = Buffer.alloc(arrayBuffer.byteLength);\n    const view = new Uint8Array(arrayBuffer);\n\n    for (let i = 0; i < buffer.length; ++i) {\n        buffer[i] = view[i];\n    }\n\n    return buffer;\n}\n\nfunction loadBufferFromPath(src, cb) {\n    if (\n        FS &&\n        typeof FS.readFile === 'function' &&\n        !src.match(/^(http|ftp)s?:\\/\\/./)\n    ) {\n        FS.readFile(src, cb);\n    } else {\n        request(src, (err, response, data) => {\n            if (err) {\n                return cb(err);\n            }\n\n            if (typeof data === 'object' && Buffer.isBuffer(data)) {\n                return cb(null, data);\n            }\n\n            const msg =\n                'Could not load Buffer from <' +\n                src +\n                '> ' +\n                '(HTTP: ' +\n                response.statusCode +\n                ')';\n\n            return new Error(msg);\n        });\n    }\n}\n\nfunction isRawRGBAData(obj) {\n    return (\n        obj &&\n        typeof obj === 'object' &&\n        typeof obj.width === 'number' &&\n        typeof obj.height === 'number' &&\n        (Buffer.isBuffer(obj.data) ||\n            obj.data instanceof Uint8Array ||\n            (typeof Uint8ClampedArray === 'function' &&\n                obj.data instanceof Uint8ClampedArray)) &&\n        (obj.data.length === obj.width * obj.height * 4 ||\n            obj.data.length === obj.width * obj.height * 3)\n    );\n}\n\nfunction makeRGBABufferFromRGB(buffer) {\n    if (buffer.length % 3 !== 0) {\n        throw new Error('Buffer length is incorrect');\n    }\n\n    const rgbaBuffer = Buffer.allocUnsafe((buffer.length / 3) * 4);\n    let j = 0;\n\n    for (let i = 0; i < buffer.length; i++) {\n        rgbaBuffer[j] = buffer[i];\n\n        if ((i + 1) % 3 === 0) {\n            rgbaBuffer[++j] = 255;\n        }\n\n        j++;\n    }\n\n    return rgbaBuffer;\n}\n\nconst emptyBitmap = {\n    data: null,\n    width: null,\n    height: null\n};\n\n/**\n * Jimp constructor (from a file)\n * @param path a path to the image\n * @param {function(Error, Jimp)} cb (optional) a function to call when the image is parsed to a bitmap\n */\n\n/**\n * Jimp constructor (from another Jimp image or raw image data)\n * @param image a Jimp image to clone\n * @param {function(Error, Jimp)} cb a function to call when the image is parsed to a bitmap\n */\n\n/**\n * Jimp constructor (from a Buffer)\n * @param data a Buffer containing the image data\n * @param {function(Error, Jimp)} cb a function to call when the image is parsed to a bitmap\n */\n\n/**\n * Jimp constructor (to generate a new image)\n * @param w the width of the image\n * @param h the height of the image\n * @param {function(Error, Jimp)} cb (optional) a function to call when the image is parsed to a bitmap\n */\n\n/**\n * Jimp constructor (to generate a new image)\n * @param w the width of the image\n * @param h the height of the image\n * @param background color to fill the image with\n * @param {function(Error, Jimp)} cb (optional) a function to call when the image is parsed to a bitmap\n */\n\nclass Jimp extends EventEmitter {\n    // An object representing a bitmap in memory, comprising:\n    //  - data: a buffer of the bitmap data\n    //  - width: the width of the image in pixels\n    //  - height: the height of the image in pixels\n    bitmap = emptyBitmap;\n\n    // The quality to be used when saving JPEG images\n    _quality = 100;\n\n    _deflateLevel = 9;\n\n    _deflateStrategy = 3;\n\n    _filterType = Jimp.PNG_FILTER_AUTO;\n\n    // Whether PNGs will be exported as RGB or RGBA\n    _rgba = true;\n\n    // Default colour to use for new pixels\n    _background = 0x00000000;\n\n    // Default MIME is PNG\n    _originalMime = Jimp.MIME_PNG;\n\n    // Exif data for the image\n    _exif = null;\n\n    constructor(...args) {\n        super();\n\n        const jimpInstance = this;\n        let cb = noop;\n\n        if (isArrayBuffer(args[0])) {\n            args[0] = bufferFromArrayBuffer(args[0]);\n        }\n\n        function finish(...args) {\n            const [err] = args;\n            const evData = err || {};\n            evData.methodName = 'constructor';\n\n            setTimeout(() => {\n                // run on next tick.\n                if (err && cb === noop) {\n                    jimpInstance.emitError('constructor', err);\n                } else if (!err) {\n                    jimpInstance.emitMulti('constructor', 'initialized');\n                }\n\n                cb.call(jimpInstance, ...args);\n            }, 1);\n        }\n\n        if (\n            (typeof args[0] === 'number' && typeof args[1] === 'number') ||\n            (parseInt(args[0], 10) && parseInt(args[1], 10))\n        ) {\n            // create a new image\n            const w = parseInt(args[0], 10);\n            const h = parseInt(args[1], 10);\n            cb = args[2];\n\n            if (typeof args[2] === 'number') {\n                this._background = args[2];\n                cb = args[3];\n            }\n\n            if (typeof cb === 'undefined') {\n                cb = noop;\n            }\n\n            if (typeof cb !== 'function') {\n                return throwError.call(this, 'cb must be a function', finish);\n            }\n\n            this.bitmap = {\n                data: Buffer.alloc(w * h * 4),\n                width: w,\n                height: h\n            };\n\n            for (let i = 0; i < this.bitmap.data.length; i += 4) {\n                this.bitmap.data.writeUInt32BE(this._background, i);\n            }\n\n            finish(null, this);\n        } else if (args[0] instanceof Jimp) {\n            // clone an existing Jimp\n            const [original] = args;\n            cb = args[1];\n\n            if (typeof cb === 'undefined') {\n                cb = noop;\n            }\n\n            if (typeof cb !== 'function') {\n                return throwError.call(this, 'cb must be a function', finish);\n            }\n\n            this.bitmap = {\n                data: Buffer.from(original.bitmap.data),\n                width: original.bitmap.width,\n                height: original.bitmap.height\n            };\n\n            this._quality = original._quality;\n            this._deflateLevel = original._deflateLevel;\n            this._deflateStrategy = original._deflateStrategy;\n            this._filterType = original._filterType;\n            this._rgba = original._rgba;\n            this._background = original._background;\n            this._originalMime = original._originalMime;\n\n            finish(null, this);\n        } else if (isRawRGBAData(args[0])) {\n            const [imageData] = args;\n            cb = args[1] || noop;\n\n            const isRGBA =\n                imageData.width * imageData.height * 4 ===\n                imageData.data.length;\n            const buffer = isRGBA\n                ? Buffer.from(imageData.data)\n                : makeRGBABufferFromRGB(imageData.data);\n\n            this.bitmap = {\n                data: buffer,\n                width: imageData.width,\n                height: imageData.height\n            };\n\n            finish(null, this);\n        } else if (typeof args[0] === 'string') {\n            // read from a path\n            const path = args[0];\n            cb = args[1];\n\n            if (typeof cb === 'undefined') {\n                cb = noop;\n            }\n\n            if (typeof cb !== 'function') {\n                return throwError.call(this, 'cb must be a function', finish);\n            }\n\n            loadBufferFromPath(path, (err, data) => {\n                if (err) {\n                    return throwError.call(this, err, finish);\n                }\n\n                parseBitmap.call(this, data, path, finish);\n            });\n        } else if (typeof args[0] === 'object' && Buffer.isBuffer(args[0])) {\n            // read from a buffer\n            const data = args[0];\n            cb = args[1];\n\n            if (typeof cb !== 'function') {\n                return throwError.call(this, 'cb must be a function', finish);\n            }\n\n            parseBitmap.call(this, data, null, finish);\n        } else {\n            // Allow client libs to add new ways to build a Jimp object.\n            // Extra constructors must be added by `Jimp.appendConstructorOption()`\n            cb = args[args.length - 1];\n\n            if (typeof cb !== 'function') {\n                // TODO: try to solve the args after cb problem.\n                cb = args[args.length - 2];\n\n                if (typeof cb !== 'function') {\n                    cb = noop;\n                }\n            }\n\n            const extraConstructor = Jimp.__extraConstructors.find(c =>\n                c.test(...args)\n            );\n\n            if (extraConstructor) {\n                new Promise((resolve, reject) =>\n                    extraConstructor.run.call(this, resolve, reject, ...args)\n                )\n                    .then(() => finish(null, this))\n                    .catch(finish);\n            } else {\n                return throwError.call(\n                    this,\n                    'No matching constructor overloading was found. ' +\n                        'Please see the docs for how to call the Jimp constructor.',\n                    finish\n                );\n            }\n        }\n    }\n\n    /**\n     * Emit for multiple listeners\n     * @param {string} methodName name of the method to emit an error for\n     * @param {string} eventName name of the eventName to emit an error for\n     * @param {object} data to emit\n     */\n    emitMulti(methodName, eventName, data = {}) {\n        data = Object.assign(data, { methodName, eventName });\n        this.emit('any', data);\n\n        if (methodName) {\n            this.emit(methodName, data);\n        }\n\n        this.emit(eventName, data);\n    }\n\n    emitError(methodName, err) {\n        this.emitMulti(methodName, 'error', err);\n    }\n\n    /**\n     * Get the current height of the image\n     * @param {number} height of the image\n     */\n    getHeight() {\n        return this.bitmap.height;\n    }\n\n    /**\n     * Get the current width of the image\n     * @param {number} width of the image\n     */\n    getWidth() {\n        return this.bitmap.width;\n    }\n\n    /**\n     * Nicely format Jimp object when sent to the console e.g. console.log(image)\n     * @returns {string} pretty printed\n     */\n    inspect() {\n        return (\n            '<Jimp ' +\n            (this.bitmap === emptyBitmap\n                ? 'pending...'\n                : this.bitmap.width + 'x' + this.bitmap.height) +\n            '>'\n        );\n    }\n\n    /**\n     * Nicely format Jimp object when converted to a string\n     * @returns {string} pretty printed\n     */\n    toString() {\n        return '[object Jimp]';\n    }\n\n    /**\n     * Returns the original MIME of the image (default: \"image/png\")\n     * @returns {string} the MIME\n     */\n    getMIME() {\n        const mime = this._originalMime || Jimp.MIME_PNG;\n\n        return mime;\n    }\n\n    /**\n     * Returns the appropriate file extension for the original MIME of the image (default: \"png\")\n     * @returns {string} the file extension\n     */\n    getExtension() {\n        const mime = this.getMIME();\n\n        return MIME.getExtension(mime);\n    }\n\n    /**\n     * Writes the image to a file\n     * @param {string} path a path to the destination file (either PNG or JPEG)\n     * @param {function(Error, Jimp)} cb (optional) a function to call when the image is saved to disk\n     * @returns {Jimp} this for chaining of methods\n     */\n    write(path, cb) {\n        if (!FS || !FS.createWriteStream) {\n            throw new Error(\n                'Cant access the filesystem. You can use the getBase64 method.'\n            );\n        }\n\n        if (typeof path !== 'string') {\n            return throwError.call(this, 'path must be a string', cb);\n        }\n\n        if (typeof cb === 'undefined') {\n            cb = noop;\n        }\n\n        if (typeof cb !== 'function') {\n            return throwError.call(this, 'cb must be a function', cb);\n        }\n\n        const mime = MIME.getType(path) || this.getMIME();\n        const pathObj = Path.parse(path);\n\n        if (pathObj.dir) {\n            MkDirP.sync(pathObj.dir);\n        }\n\n        this.getBuffer(mime, (err, buffer) => {\n            if (err) {\n                return throwError.call(this, err, cb);\n            }\n\n            const stream = FS.createWriteStream(path);\n\n            stream\n                .on('open', () => {\n                    stream.write(buffer);\n                    stream.end();\n                })\n                .on('error', err => {\n                    return throwError.call(this, err, cb);\n                });\n            stream.on('finish', () => {\n                cb.call(this, null, this);\n            });\n        });\n\n        return this;\n    }\n\n    writeAsync = path => promisify(this.write, this, path);\n\n    /**\n     * Sets the deflate level used when saving as PNG format (default is 9)\n     * @param {number} l Deflate level to use 0-9. 0 is no compression. 9 (default) is maximum compression.\n     * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n     * @returns {Jimp} this for chaining of methods\n     */\n    deflateLevel(l, cb) {\n        if (typeof l !== 'number') {\n            return throwError.call(this, 'l must be a number', cb);\n        }\n\n        if (l < 0 || l > 9) {\n            return throwError.call(this, 'l must be a number 0 - 9', cb);\n        }\n\n        this._deflateLevel = Math.round(l);\n\n        if (isNodePattern(cb)) {\n            cb.call(this, null, this);\n        }\n\n        return this;\n    }\n\n    /**\n     * Sets the deflate strategy used when saving as PNG format (default is 3)\n     * @param {number} s Deflate strategy to use 0-3.\n     * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n     * @returns {Jimp} this for chaining of methods\n     */\n    deflateStrategy(s, cb) {\n        if (typeof s !== 'number') {\n            return throwError.call(this, 's must be a number', cb);\n        }\n\n        if (s < 0 || s > 3) {\n            return throwError.call(this, 's must be a number 0 - 3', cb);\n        }\n\n        this._deflateStrategy = Math.round(s);\n\n        if (isNodePattern(cb)) {\n            cb.call(this, null, this);\n        }\n\n        return this;\n    }\n\n    /**\n     * Sets the filter type used when saving as PNG format (default is automatic filters)\n     * @param {number} f The quality to use -1-4.\n     * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n     * @returns {Jimp} this for chaining of methods\n     */\n    filterType(f, cb) {\n        if (typeof f !== 'number') {\n            return throwError.call(this, 'n must be a number', cb);\n        }\n\n        if (f < -1 || f > 4) {\n            return throwError.call(\n                this,\n                'n must be -1 (auto) or a number 0 - 4',\n                cb\n            );\n        }\n\n        this._filterType = Math.round(f);\n\n        if (isNodePattern(cb)) {\n            cb.call(this, null, this);\n        }\n\n        return this;\n    }\n\n    /**\n     * Sets the type of the image (RGB or RGBA) when saving as PNG format (default is RGBA)\n     * @param {boolean} bool A Boolean, true to use RGBA or false to use RGB\n     * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n     * @returns {Jimp} this for chaining of methods\n     */\n    rgba(bool, cb) {\n        if (typeof bool !== 'boolean') {\n            return throwError.call(\n                this,\n                'bool must be a boolean, true for RGBA or false for RGB',\n                cb\n            );\n        }\n\n        this._rgba = bool;\n\n        if (isNodePattern(cb)) {\n            cb.call(this, null, this);\n        }\n\n        return this;\n    }\n\n    /**\n     * Sets the quality of the image when saving as JPEG format (default is 100)\n     * @param {number} n The quality to use 0-100\n     * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n     * @returns {Jimp} this for chaining of methods\n     */\n    quality(n, cb) {\n        if (typeof n !== 'number') {\n            return throwError.call(this, 'n must be a number', cb);\n        }\n\n        if (n < 0 || n > 100) {\n            return throwError.call(this, 'n must be a number 0 - 100', cb);\n        }\n\n        this._quality = Math.round(n);\n\n        if (isNodePattern(cb)) {\n            cb.call(this, null, this);\n        }\n\n        return this;\n    }\n\n    /**\n     * Converts the image to a base 64 string\n     * @param {string} mime the mime type of the image data to be created\n     * @param {function(Error, Jimp)} cb a Node-style function to call with the buffer as the second argument\n     * @returns {Jimp} this for chaining of methods\n     */\n    getBase64(mime, cb) {\n        if (mime === Jimp.AUTO) {\n            // allow auto MIME detection\n            mime = this.getMIME();\n        }\n\n        if (typeof mime !== 'string') {\n            return throwError.call(this, 'mime must be a string', cb);\n        }\n\n        if (typeof cb !== 'function') {\n            return throwError.call(this, 'cb must be a function', cb);\n        }\n\n        this.getBuffer(mime, function(err, data) {\n            if (err) {\n                return throwError.call(this, err, cb);\n            }\n\n            const src = 'data:' + mime + ';base64,' + data.toString('base64');\n            cb.call(this, null, src);\n        });\n\n        return this;\n    }\n\n    getBase64Async = mime => promisify(this.getBase64, this, mime);\n\n    /**\n     * Generates a perceptual hash of the image <https://en.wikipedia.org/wiki/Perceptual_hashing>.\n     * @param {number} base (optional) a number between 2 and 64 representing the base for the hash (e.g. 2 is binary, 10 is decimal, 16 is hex, 64 is base 64). Defaults to 64.\n     * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n     * @returns {string} a string representing the hash\n     */\n    hash(base, cb) {\n        base = base || 64;\n\n        if (typeof base === 'function') {\n            cb = base;\n            base = 64;\n        }\n\n        if (typeof base !== 'number') {\n            return throwError.call(this, 'base must be a number', cb);\n        }\n\n        if (base < 2 || base > 64) {\n            return throwError.call(\n                this,\n                'base must be a number between 2 and 64',\n                cb\n            );\n        }\n\n        let hash = new ImagePHash().getHash(this);\n        hash = anyBase(anyBase.BIN, alphabet.slice(0, base))(hash);\n\n        while (hash.length < maxHashLength[base]) {\n            hash = '0' + hash; // pad out with leading zeros\n        }\n\n        if (isNodePattern(cb)) {\n            cb.call(this, null, hash);\n        }\n\n        return hash;\n    }\n\n    /**\n     * Converts the image to a buffer\n     * @param {string} mime the mime type of the image buffer to be created\n     * @param {function(Error, Jimp)} cb a Node-style function to call with the buffer as the second argument\n     * @returns {Jimp} this for chaining of methods\n     */\n    getBuffer = getBuffer;\n\n    getBufferAsync = getBufferAsync;\n\n    /**\n     * Returns the offset of a pixel in the bitmap buffer\n     * @param {number} x the x coordinate\n     * @param {number} y the y coordinate\n     * @param {string} edgeHandling (optional) define how to sum pixels from outside the border\n     * @param {number} cb (optional) a callback for when complete\n     * @returns {number} the index of the pixel or -1 if not found\n     */\n    getPixelIndex(x, y, edgeHandling, cb) {\n        let xi;\n        let yi;\n\n        if (typeof edgeHandling === 'function' && typeof cb === 'undefined') {\n            cb = edgeHandling;\n            edgeHandling = null;\n        }\n\n        if (!edgeHandling) {\n            edgeHandling = Jimp.EDGE_EXTEND;\n        }\n\n        if (typeof x !== 'number' || typeof y !== 'number') {\n            return throwError.call(this, 'x and y must be numbers', cb);\n        }\n\n        // round input\n        x = Math.round(x);\n        y = Math.round(y);\n        xi = x;\n        yi = y;\n\n        if (edgeHandling === Jimp.EDGE_EXTEND) {\n            if (x < 0) xi = 0;\n            if (x >= this.bitmap.width) xi = this.bitmap.width - 1;\n            if (y < 0) yi = 0;\n            if (y >= this.bitmap.height) yi = this.bitmap.height - 1;\n        }\n\n        if (edgeHandling === Jimp.EDGE_WRAP) {\n            if (x < 0) {\n                xi = this.bitmap.width + x;\n            }\n\n            if (x >= this.bitmap.width) {\n                xi = x % this.bitmap.width;\n            }\n\n            if (y < 0) {\n                xi = this.bitmap.height + y;\n            }\n\n            if (y >= this.bitmap.height) {\n                yi = y % this.bitmap.height;\n            }\n        }\n\n        let i = (this.bitmap.width * yi + xi) << 2;\n\n        // if out of bounds index is -1\n        if (xi < 0 || xi >= this.bitmap.width) {\n            i = -1;\n        }\n\n        if (yi < 0 || yi >= this.bitmap.height) {\n            i = -1;\n        }\n\n        if (isNodePattern(cb)) {\n            cb.call(this, null, i);\n        }\n\n        return i;\n    }\n\n    /**\n     * Returns the hex colour value of a pixel\n     * @param {number} x the x coordinate\n     * @param {number} y the y coordinate\n     * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n     * @returns {number} the color of the pixel\n     */\n    getPixelColor(x, y, cb) {\n        if (typeof x !== 'number' || typeof y !== 'number')\n            return throwError.call(this, 'x and y must be numbers', cb);\n\n        // round input\n        x = Math.round(x);\n        y = Math.round(y);\n\n        const idx = this.getPixelIndex(x, y);\n        const hex = this.bitmap.data.readUInt32BE(idx);\n\n        if (isNodePattern(cb)) {\n            cb.call(this, null, hex);\n        }\n\n        return hex;\n    }\n\n    getPixelColour = this.getPixelColor;\n\n    /**\n     * Returns the hex colour value of a pixel\n     * @param {number} hex color to set\n     * @param {number} x the x coordinate\n     * @param {number} y the y coordinate\n     * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n     * @returns {number} the index of the pixel or -1 if not found\n     */\n    setPixelColor(hex, x, y, cb) {\n        if (\n            typeof hex !== 'number' ||\n            typeof x !== 'number' ||\n            typeof y !== 'number'\n        )\n            return throwError.call(this, 'hex, x and y must be numbers', cb);\n\n        // round input\n        x = Math.round(x);\n        y = Math.round(y);\n\n        const idx = this.getPixelIndex(x, y);\n        this.bitmap.data.writeUInt32BE(hex, idx);\n\n        if (isNodePattern(cb)) {\n            cb.call(this, null, this);\n        }\n\n        return this;\n    }\n\n    setPixelColour = this.setPixelColor;\n}\n\nObject.entries(constants).forEach(([name, value]) => {\n    Jimp[name] = value;\n});\n\nObject.entries({ ...color, ...shape, ...text, ...effects }).forEach(\n    ([name, value]) => {\n        Jimp.prototype[name] = value;\n    }\n);\n\nJimp.__extraConstructors = [];\n\n/**\n * Allow client libs to add new ways to build a Jimp object.\n * @param {string} name identify the extra constructor.\n * @param {function} test a function that returns true when it accepts the arguments passed to the main constructor.\n * @param {function} run where the magic happens.\n */\nJimp.appendConstructorOption = function(name, test, run) {\n    Jimp.__extraConstructors.push({ name, test, run });\n};\n\n/**\n * Read an image from a file or a Buffer. Takes the same args as the constructor\n * @returns {Promise} a promise\n */\nJimp.read = function(...args) {\n    return new Promise((resolve, reject) => {\n        new Jimp(...args, (err, image) => {\n            if (err) reject(err);\n            else resolve(image);\n        });\n    });\n};\n\nJimp.create = Jimp.read;\n\n/**\n * A static helper method that converts RGBA values to a single integer value\n * @param {number} r the red value (0-255)\n * @param {number} g the green value (0-255)\n * @param {number} b the blue value (0-255)\n * @param {number} a the alpha value (0-255)\n * @param {function(Error, Jimp)} cb (optional) A callback for when complete\n * @returns {number} an single integer colour value\n */\nJimp.rgbaToInt = function(r, g, b, a, cb) {\n    if (\n        typeof r !== 'number' ||\n        typeof g !== 'number' ||\n        typeof b !== 'number' ||\n        typeof a !== 'number'\n    ) {\n        return throwError.call(this, 'r, g, b and a must be numbers', cb);\n    }\n\n    if (r < 0 || r > 255) {\n        return throwError.call(this, 'r must be between 0 and 255', cb);\n    }\n\n    if (g < 0 || g > 255) {\n        throwError.call(this, 'g must be between 0 and 255', cb);\n    }\n\n    if (b < 0 || b > 255) {\n        return throwError.call(this, 'b must be between 0 and 255', cb);\n    }\n\n    if (a < 0 || a > 255) {\n        return throwError.call(this, 'a must be between 0 and 255', cb);\n    }\n\n    r = Math.round(r);\n    b = Math.round(b);\n    g = Math.round(g);\n    a = Math.round(a);\n\n    const i =\n        r * Math.pow(256, 3) +\n        g * Math.pow(256, 2) +\n        b * Math.pow(256, 1) +\n        a * Math.pow(256, 0);\n\n    if (isNodePattern(cb)) {\n        cb.call(this, null, i);\n    }\n\n    return i;\n};\n\n/**\n * A static helper method that converts RGBA values to a single integer value\n * @param {number} i a single integer value representing an RGBA colour (e.g. 0xFF0000FF for red)\n * @param {function(Error, Jimp)} cb (optional) A callback for when complete\n * @returns {object} an object with the properties r, g, b and a representing RGBA values\n */\nJimp.intToRGBA = function(i, cb) {\n    if (typeof i !== 'number') {\n        return throwError.call(this, 'i must be a number', cb);\n    }\n\n    const rgba = {};\n\n    rgba.r = Math.floor(i / Math.pow(256, 3));\n    rgba.g = Math.floor((i - rgba.r * Math.pow(256, 3)) / Math.pow(256, 2));\n    rgba.b = Math.floor(\n        (i - rgba.r * Math.pow(256, 3) - rgba.g * Math.pow(256, 2)) /\n            Math.pow(256, 1)\n    );\n    rgba.a = Math.floor(\n        (i -\n            rgba.r * Math.pow(256, 3) -\n            rgba.g * Math.pow(256, 2) -\n            rgba.b * Math.pow(256, 1)) /\n            Math.pow(256, 0)\n    );\n\n    if (isNodePattern(cb)) {\n        cb.call(this, null, rgba);\n    }\n\n    return rgba;\n};\n\n/**\n * Limits a number to between 0 or 255\n * @param {number} n a number\n * @returns {number} the number limited to between 0 or 255\n */\nJimp.limit255 = function(n) {\n    n = Math.max(n, 0);\n    n = Math.min(n, 255);\n\n    return n;\n};\n\n/**\n * Diffs two images and returns\n * @param {Jimp} img1 a Jimp image to compare\n * @param {Jimp} img2 a Jimp image to compare\n * @param {number} threshold (optional) a number, 0 to 1, the smaller the value the more sensitive the comparison (default: 0.1)\n * @returns {object} an object { percent: percent similar, diff: a Jimp image highlighting differences }\n */\nJimp.diff = function(img1, img2, threshold = 0.1) {\n    if (!(img1 instanceof Jimp) || !(img2 instanceof Jimp))\n        return throwError.call(this, 'img1 and img2 must be an Jimp images');\n\n    const bmp1 = img1.bitmap;\n    const bmp2 = img2.bitmap;\n\n    if (bmp1.width !== bmp2.width || bmp1.height !== bmp2.height) {\n        if (bmp1.width * bmp1.height > bmp2.width * bmp2.height) {\n            // img1 is bigger\n            img1 = img1.cloneQuiet().resize(bmp2.width, bmp2.height);\n        } else {\n            // img2 is bigger (or they are the same in area)\n            img2 = img2.cloneQuiet().resize(bmp1.width, bmp1.height);\n        }\n    }\n\n    if (typeof threshold !== 'number' || threshold < 0 || threshold > 1) {\n        return throwError.call(\n            this,\n            'threshold must be a number between 0 and 1'\n        );\n    }\n\n    const diff = new Jimp(bmp1.width, bmp1.height, 0xffffffff);\n\n    const numDiffPixels = pixelMatch(\n        bmp1.data,\n        bmp2.data,\n        diff.bitmap.data,\n        diff.bitmap.width,\n        diff.bitmap.height,\n        { threshold }\n    );\n\n    return {\n        percent: numDiffPixels / (diff.bitmap.width * diff.bitmap.height),\n        image: diff\n    };\n};\n\n/**\n * Calculates the hamming distance of two images based on their perceptual hash\n * @param {Jimp} img1 a Jimp image to compare\n * @param {Jimp} img2 a Jimp image to compare\n * @returns {number} a number ranging from 0 to 1, 0 means they are believed to be identical\n */\nJimp.distance = function(img1, img2) {\n    const phash = new ImagePHash();\n    const hash1 = phash.getHash(img1);\n    const hash2 = phash.getHash(img2);\n\n    return phash.distance(hash1, hash2);\n};\n\n/**\n * Compute color difference\n * 0 means no difference, 1 means maximum difference.\n * @param {number} rgba1:    first color to compare.\n * @param {number} rgba2:    second color to compare.\n * Both parameters must be an color object {r:val, g:val, b:val, a:val}\n * Where `a` is optional and `val` is an integer between 0 and 255.\n * @returns {number} float between 0 and 1.\n */\nJimp.colorDiff = function(rgba1, rgba2) {\n    const pow = n => Math.pow(n, 2);\n    const { max } = Math;\n    const maxVal = 255 * 255 * 3;\n\n    if (rgba1.a !== 0 && !rgba1.a) {\n        rgba1.a = 255;\n    }\n\n    if (rgba2.a !== 0 && !rgba2.a) {\n        rgba2.a = 255;\n    }\n\n    return (\n        (max(\n            pow(rgba1.r - rgba2.r),\n            pow(rgba1.r - rgba2.r - rgba1.a + rgba2.a)\n        ) +\n            max(\n                pow(rgba1.g - rgba2.g),\n                pow(rgba1.g - rgba2.g - rgba1.a + rgba2.a)\n            ) +\n            max(\n                pow(rgba1.b - rgba2.b),\n                pow(rgba1.b - rgba2.b - rgba1.a + rgba2.a)\n            )) /\n        maxVal\n    );\n};\n\nfunction loadPages(dir, pages) {\n    const newPages = pages.map(page => {\n        return Jimp.read(dir + '/' + page);\n    });\n\n    return Promise.all(newPages);\n}\n\n/**\n * Loads a bitmap font from a file\n * @param {string} file the file path of a .fnt file\n * @param {function(Error, Jimp)} cb (optional) a function to call when the font is loaded\n * @returns {Promise} a promise\n */\nJimp.loadFont = function(file, cb) {\n    if (typeof file !== 'string')\n        return throwError.call(this, 'file must be a string', cb);\n\n    return new Promise((resolve, reject) => {\n        cb =\n            cb ||\n            function(err, font) {\n                if (err) reject(err);\n                else resolve(font);\n            };\n\n        bMFont(file, (err, font) => {\n            const chars = {};\n            const kernings = {};\n\n            if (err) {\n                return throwError.call(this, err, cb);\n            }\n\n            for (let i = 0; i < font.chars.length; i++) {\n                chars[String.fromCharCode(font.chars[i].id)] = font.chars[i];\n            }\n\n            for (let i = 0; i < font.kernings.length; i++) {\n                const firstString = String.fromCharCode(font.kernings[i].first);\n                kernings[firstString] = kernings[firstString] || {};\n                kernings[firstString][\n                    String.fromCharCode(font.kernings[i].second)\n                ] =\n                    font.kernings[i].amount;\n            }\n\n            loadPages(Path.dirname(file), font.pages).then(pages => {\n                cb(null, {\n                    chars,\n                    kernings,\n                    pages,\n                    common: font.common,\n                    info: font.info\n                });\n            });\n        });\n    });\n};\n\n/**\n * Helper to create Jimp methods that emit events before and after its execution.\n * @param {string} methodName   The name to be appended to Jimp prototype.\n * @param {string} evName       The event name to be called.\n *                     It will be prefixed by `before-` and emitted when on method call.\n *                     It will be appended by `ed` and emitted after the method run.\n * @param {function} method       A function implementing the method itself.\n * It will also create a quiet version that will not emit events, to not\n * mess the user code with many `changed` event calls. You can call with\n * `methodName + \"Quiet\"`.\n *\n * The emitted event comes with a object parameter to the listener with the\n * `methodName` as one attribute.\n */\nfunction jimpEvMethod(methodName, evName, method) {\n    const evNameBefore = 'before-' + evName;\n    const evNameAfter = evName.replace(/e$/, '') + 'ed';\n\n    Jimp.prototype[methodName] = function(...args) {\n        let wrappedCb;\n        const cb = args[method.length - 1];\n        const jimpInstance = this;\n\n        if (typeof cb === 'function') {\n            wrappedCb = function(...args) {\n                const [err, data] = args;\n\n                if (err) {\n                    jimpInstance.emitError(methodName, err);\n                } else {\n                    jimpInstance.emitMulti(methodName, evNameAfter, {\n                        [methodName]: data\n                    });\n                }\n\n                cb.apply(this, args);\n            };\n            args[args.length - 1] = wrappedCb;\n        } else {\n            wrappedCb = false;\n        }\n\n        this.emitMulti(methodName, evNameBefore);\n\n        let result;\n\n        try {\n            result = method.apply(this, args);\n\n            if (!wrappedCb) {\n                this.emitMulti(methodName, evNameAfter, {\n                    [methodName]: result\n                });\n            }\n        } catch (err) {\n            err.methodName = methodName;\n            this.emitError(methodName, err);\n        }\n\n        return result;\n    };\n\n    Jimp.prototype[methodName + 'Quiet'] = method;\n}\n\n/**\n * Creates a new image that is a clone of this one.\n * @param {function(Error, Jimp)} cb (optional) A callback for when complete\n * @returns the new image\n */\njimpEvMethod('clone', 'clone', function(cb) {\n    const clone = new Jimp(this);\n\n    if (isNodePattern(cb)) {\n        cb.call(clone, null, clone);\n    }\n\n    return clone;\n});\n\n/**\n * Simplify jimpEvMethod call for the common `change` evName.\n * @param {string} methodName name of the method\n * @param {function} method to watch changes for\n */\nfunction jimpEvChange(methodName, method) {\n    jimpEvMethod(methodName, 'change', method);\n}\n\n/**\n * Sets the type of the image (RGB or RGBA) when saving as PNG format (default is RGBA)\n * @param b A Boolean, true to use RGBA or false to use RGB\n * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n * @returns {Jimp} this for chaining of methods\n */\njimpEvChange('background', function(hex, cb) {\n    if (typeof hex !== 'number') {\n        return throwError.call(\n            this,\n            'hex must be a hexadecimal rgba value',\n            cb\n        );\n    }\n\n    this._background = hex;\n\n    if (isNodePattern(cb)) {\n        cb.call(this, null, this);\n    }\n\n    return this;\n});\n\n/**\n * Scans through a region of the bitmap, calling a function for each pixel.\n * @param {number} x the x coordinate to begin the scan at\n * @param {number} y the y coordinate to begin the scan at\n * @param w the width of the scan region\n * @param h the height of the scan region\n * @param f a function to call on even pixel; the (x, y) position of the pixel\n * and the index of the pixel in the bitmap buffer are passed to the function\n * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n * @returns {Jimp} this for chaining of methods\n */\njimpEvChange('scan', function(x, y, w, h, f, cb) {\n    if (typeof x !== 'number' || typeof y !== 'number') {\n        return throwError.call(this, 'x and y must be numbers', cb);\n    }\n\n    if (typeof w !== 'number' || typeof h !== 'number') {\n        return throwError.call(this, 'w and h must be numbers', cb);\n    }\n\n    if (typeof f !== 'function') {\n        return throwError.call(this, 'f must be a function', cb);\n    }\n\n    const result = scan(this, x, y, w, h, f);\n\n    if (isNodePattern(cb)) {\n        cb.call(this, null, result);\n    }\n\n    return result;\n});\n\n/**\n * Crops the image at a given point to a give size\n * @param {number} x the x coordinate to crop form\n * @param {number} y the y coordinate to crop form\n * @param w the width of the crop region\n * @param h the height of the crop region\n * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n * @returns {Jimp} this for chaining of methods\n */\njimpEvChange('crop', function(x, y, w, h, cb) {\n    if (typeof x !== 'number' || typeof y !== 'number')\n        return throwError.call(this, 'x and y must be numbers', cb);\n    if (typeof w !== 'number' || typeof h !== 'number')\n        return throwError.call(this, 'w and h must be numbers', cb);\n\n    // round input\n    x = Math.round(x);\n    y = Math.round(y);\n    w = Math.round(w);\n    h = Math.round(h);\n\n    if (x === 0 && w === this.bitmap.width) {\n        // shortcut\n        const start = (w * y + x) << 2;\n        const end = (start + h * w) << (2 + 1);\n\n        this.bitmap.data = this.bitmap.data.slice(start, end);\n    } else {\n        const bitmap = Buffer.allocUnsafe(w * h * 4);\n        let offset = 0;\n\n        this.scanQuiet(x, y, w, h, function(x, y, idx) {\n            const data = this.bitmap.data.readUInt32BE(idx, true);\n            bitmap.writeUInt32BE(data, offset, true);\n            offset += 4;\n        });\n\n        this.bitmap.data = bitmap;\n    }\n\n    this.bitmap.width = w;\n    this.bitmap.height = h;\n\n    if (isNodePattern(cb)) {\n        cb.call(this, null, this);\n    }\n\n    return this;\n});\n\nif (process.env.ENVIRONMENT === 'BROWSER') {\n    // For use in a web browser or web worker\n    /* global self */\n    let gl;\n\n    if (typeof window !== 'undefined' && typeof window === 'object') {\n        gl = window;\n    }\n\n    if (typeof self !== 'undefined' && typeof self === 'object') {\n        gl = self;\n    }\n\n    gl.Jimp = Jimp;\n    gl.Buffer = Buffer;\n}\n\nexport default Jimp;\n"],"file":"index.js"}